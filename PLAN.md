# Document Feature Implementation Plan

## Overview
This document outlines the plan for implementing a document feature in GraphChat. Documents can be manually created with a text editor or generated by AI from chat context. Documents can be referenced during chats, pulling relevant portions into the conversation. This feature supports use cases like exploratory worldbuilding where users can chat about fantasy worlds and create documents about nations, people, political structures, events, etc.

## Architecture Changes

### 1. New State Management
- Create a new document store using legendapp/state with localStorage persistence
- Define document data structure:
  ```typescript
  interface Document {
    id: string;
    title: string;
    content: string;
    createdAt: Date;
    updatedAt: Date;
    tags: string[];
  }
  ```
- Store documents in a global observable similar to chatStore$

### 2. Routing and Navigation
- Add a new documents page route (`/documents`)
- Add navigation between chat and documents pages
- Create a navigation bar component to switch between pages

### 3. UI Components
- Create a documents list view showing all documents
- Create a document editor view with a text editor
- Enhance the chat input to support document auto-completion
- Add a document reference panel in chat to show referenced documents

### 4. Document Creation
- Manual creation through a text editor
- AI generation from chat context:
  - Button to create document from current chat
  - Option to generate document from selected messages
  - AI summarization of chat content into document format

### 5. Document Referencing in Chat
- Auto-complete for document names in chat input (triggered by @)
- System to extract relevant portions of documents when referenced
- Integration with LLM functions to include document context

## Implementation Steps

### Phase 1: Core Infrastructure
1. Create document state management
2. Add document routes and navigation
3. Implement basic document CRUD operations

### Phase 2: UI Components
1. Create documents list page
2. Create document editor page
3. Add text editor component with save functionality

### Phase 3: Document Creation Features
1. Implement manual document creation
2. Add AI document generation from chat context

### Phase 4: Document Referencing
1. Enhance chat input with document auto-complete
2. Implement document reference extraction system
3. Modify LLM functions to include document context

### Phase 5: Advanced Features
1. Add document tagging and search
2. Implement document versioning
3. Add document sharing capabilities

## Technical Details

### State Management
- Use legendapp/state for reactive document state
- Persist documents to localStorage
- Sync state across components

### Routing
- Use TanStack Router for navigation
- Add route guards for document access
- Implement proper URL structure for documents

### UI/UX
- Use existing Tailwind CSS styling conventions
- Maintain dark theme consistency
- Implement responsive design

### LLM Integration
- Modify prompt construction to include document context
- Implement relevance scoring for document sections
- Add document-aware token management

## File Structure
```
src/
├── lib/
│   └── state/
│       ├── documents.ts  # Document state management
│       └── index.ts      # Export all state
├── routes/
│   ├── documents/        # Documents route
│   │   ├── index.tsx     # Documents list
│   │   └── $id.tsx       # Document editor
│   └── __root.tsx        # Updated with navigation
├── components/
│   ├── DocumentEditor.tsx     # Text editor component
│   ├── DocumentList.tsx       # Documents list component
│   ├── DocumentReference.tsx  # Document reference panel
│   └── Navigation.tsx         # Navigation bar
└── utils/
    └── document-helpers.ts    # Document utility functions
```

## Dependencies
- Existing dependencies should be sufficient
- Consider adding a rich text editor library if needed (e.g., TipTap, Slate)

## Testing
- Unit tests for document state management
- Integration tests for document creation and editing
- E2E tests for document referencing in chat

## Future Enhancements
- Collaborative document editing
- Document templates
- Export/import functionality (PDF, Markdown)
- Advanced search and filtering
- Document relationships and linking